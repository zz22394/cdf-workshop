# Cloudera CDP / CDF Workshop


## Hands on概要：
1) NiFi でテストデータを集めて、Kafkaに送る

2) SMMのWebUIで、KafkaのTopic作成とKafka管理

3) NiFiで、KafkaのデータをHDFSに保存

4) HDFSに保存したデータをHUE+Hiveで分析

5) HDFSに保存したデータをCML+Sparkで分析


## 1)データ収集
自分のアカウント・サーバーを取得。
サーバーアドレス：


### 1.1 Cloudera Managerにログイン
CM URL:

http://<public-ip>:7180/cmf/login

admin/admin

### 1.2 NiFi でデータ収集のデータフロー作成

image::smm/105_CM.png[width=800]

#### 1.2.1 NiFi にログイン

image::smm/108_CM_NiFi.png[width=800]

#### 1.2.2 テンプレートをアップロード

file::smm/produce-movies.xml

image::smm/110_NiFi_Template.png[width=800]

image::smm/112_NiFi_Template2.png[width=800]

image::smm/113_NiFi_Template3.png[width=800]

#### 1.2.3 Template を選択：

image::smm/114_NiFi_Choose_Temp.png[width=800]

#### 1.2.4 Template Import完了

image::smm/115_NiFi_Choose_Temp2.png.png[width=800]

image::smm/116_NiFi_Choose_Temp3.png.png[width=800]


### 1.3 SMM でKafka管理

SMM にログイン

image::smm/130_SMM_01.png[width=800]

image::smm/130_SMM_02.png[width=800]


```sql
create database testdb;
use testdb;
create table test01 (a01 string);

CREATE EXTERNAL TABLE IF NOT EXISTS movies
  (ID int,
  title string,
  genres string
  )
  ROW FORMAT DELIMITED
  FIELDS TERMINATED BY ','
  STORED AS TEXTFILE
  LOCATION '/user/centos/movies';


select count(*) from movies;

select * from movies limit 10;
```



```scala
//import org.apache.spark
import org.apache.spark.sql.types._;

val schema = (new StructType).add("id", IntegerType).add("title", StringType).add("genres", StringType)

val input_df = spark.read.option("Sep", ",").schema(schema).csv("/user/centos/movies/")
input_df.write.option("compression", "snappy").parquet("/user/centos/movies_parquet/")
```